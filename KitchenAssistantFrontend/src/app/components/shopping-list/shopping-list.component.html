
<div class="container-fluid">
    <div class="row">
        <main class="contentProduct">
            <div class="items-box" >
                <div class="elem-box text-success" click-stop-propagation (click)="showCreateView()">
                    <p>Utwórz nową listę zakupów</p>

                    <div *ngIf="createMode" class="createMode" [class.d-none]="!createMode">
                        <input type="text" 
                        #titleInput="ngModel"
                        [(ngModel)]="shoppingList!.listTitle" 
                        placeholder="Tytuł listy zakupów" 
                        class="form-control m-1"
                        required 
                        minlength="3"
                        [class.is-invalid]="titleInput.invalid && titleInput.touched"/>
                        <div *ngIf="titleInput.invalid && titleInput.touched" class="text-danger small ms-1">
                            Tytuł musi mieć co najmniej 3 znaki.
                        </div>
                        <select size ="2" [(ngModel)]="shoppingList!.recurrencePattern" class="m-1 form-select text-center">
                            <option selected disabled [value]="RecurrencePattern.BRAK">Wybierz cykliczność</option>
                            <option *ngFor="let option of recurrenceOptions" [value]="option">
                                {{labels[option]}}
                            </option>
                        </select>
                        <div *ngIf="shoppingList!.recurrencePattern !== RecurrencePattern.BRAK">
                            <p>Ustaw datę zaczynającą cykl:
                            <input type="Date" [(ngModel)]="shoppingList!.startOccurrenceDate" class="m-1 form-control"/>
                        </div>    
                        <div class="text-center m-3">
                            <button type="submit" class="btn btn-info" click-stop-propagation (click)="onCreate(shoppingList!)"> Zapisz </button>
                        </div>
                    </div>
                </div>
                
            </div>
            <div *ngFor="let list of shoppingLists" class="items-box">
                <div class="elem-box">
                    <div class="shoppingListElem" [class.d-none]="editingListId === list.id">
                            <div class="mb-3 ms-auto">
                                <button class= "btn btn-secondary btn-sm m-1" aria-label="Edit" title="Kliknij, aby edytować listę zakupów"
                                click-stop-propagation (click)="setEditingListId(list.id!)">
                                ...</button>
                                <button click-stop-propagation (click)="onDelete(list.id!)" 
                                type="button" class="btn btn-danger btn-sm m-1" aria-label="Close" 
                                title="Kliknij, aby usunąć listę zakupów">×
                                </button>
                            </div>
                        <a [routerLink]="['/shoppingList/', list.id]">
                            <h3>{{list.listTitle}}</h3>
                            <div *ngIf="list?.recurrencePattern !== 'BRAK'">
                                <p>cykl: {{list.recurrencePattern}}</p>
                                <p>początek cyklu: {{list.startOccurrenceDate}}</p>
                                <p>koniec cyklu: {{list.nextOccurrenceDate}}</p>
                            </div>    
                        </a>
                    </div>
                    <div class= "d-none shoppingListEdit" [class.d-none]="editingListId !== list.id" >
                        <input type="text" 
                        [(ngModel)]="list.listTitle"
                        class="m-1 form-control" 
                        #titleInput="ngModel"
                        required 
                        minlength="3"
                        placeholde = "Tytuł listy zakupów"
                        [class.is-invalid]="titleInput.invalid && titleInput.touched"/>
                        <div *ngIf="titleInput.invalid && titleInput.touched" class="text-danger small ms-1">
                            Tytuł musi mieć co najmniej 3 znaki.
                        </div>
                        <select size ="1" [(ngModel)]="list.recurrencePattern" class="m-1 form-select text-center">
                            <option selected disabled [value]="RecurrencePattern.BRAK">Wybierz cykliczność</option>
                            <option *ngFor="let option of recurrenceOptions" [value]="option">
                                {{labels[option]}}
                            </option>
                        </select>
                        <div *ngIf="list.recurrencePattern !== 'BRAK'">
                            <p>Ustaw datę zaczynającą cykl:
                            <input type="Date" [(ngModel)]="list.startOccurrenceDate" class="m-1 form-control"/>
                        </div>    
                        <!-- submit button-->
                        <div class="text-center m-3">
                            <button type="submit" class="btn btn-info" (click)="onUpdate(list)"> Zapisz </button>
                        </div>
                    </div> 
                </div>
            </div>
        </main>
    </div>
</div>